<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análise Funcional Automática</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='/img/favicon.ico') }}"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script type="text/javascript" src="{{ url_for('static', filename='js/index_network.js') }}"></script>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
</head>
<body>
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner-border text-light" role="status">
            <span class="visually-hidden">Carregando...</span>
        </div>
        <p>Gerando Análise ... Isso vai levar alguns minutos. Não atualize a página.</p>
    </div>

    <header class="jumbotron jumbotron-fluid text-center">
        <div class="container">
            <h1 class="display-4">Análise Funcional Automática</h1>
            <p class="lead">Transforme textos narrativos em redes visuais de contingências comportamentais.</p>
            
            
            <div id="network" class="flex-grow-1" style="height: 80vh;"></div>
            <p class="align-end">Esta é uma rede de contingências que demonstra o comportamento do usuário desse protótipo. Use (+) e (-) para o Zoom.</p>

        </div>
    </header>

    <div class="container mt-4">
    
        <div class="row">
            <div class="col-md-6">
                    <section id="nova-analise" class="mb-4">
                    <h2 class="my-2">Nova Análise</h2>
                    <form action="/analise" method="POST">
                        <div class="mb-3">
                            <textarea class="form-control mb-1" name="texto_entrada" rows="10" cols="80" placeholder="Insira aqui o texto que servirá de base para a análise funcional." maxlength="2000"></textarea>
                        </div>
                        <div class="row ">
                            <div class="col">
                                <div id="charCountIndex" class="text-end text-muted">0/2000 caracteres</div>
                            </div>
                            <div class="col">
                                <button type="submit" class="btn btn-primary">Analisar Texto</button>
                            </div>
                        </div>
                    </form>
                    </section>
                </div>
                <div class="col-md-6">
                    <section id="ver-exemplos" class="mb-4">
                    <h2 class="my-2">Exemplos de Análises</h2>
                    {% if example_files and example_files|length > 0 %}
                        <p>Os seguintes exemplos de análises foram gerados a partir das Fábulas de Esopo.</p>
                        <ul class="list-group mt-3">
                            {% for filename in example_files %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    {{ filename.replace('_', ' ')|replace('.json', '')|title }}
                                    <a href="{{ url_for('load_example', example_filename=filename) }}" class="btn btn-primary btn-sm">
                                        Ver <i class="fas fa-eye"></i>
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="alert alert-info mt-3">
                            <i class="fas fa-info-circle"></i> Nenhum exemplo JSON encontrado na pasta <code>static/json/examples/</code>.
                            Adicione arquivos <code>.json</code> nesta pasta para vê-los listados aqui.
                        </p>
                        <p>Por exemplo, se você tiver um arquivo de análise chamado <code>meu_exemplo_de_analise.json</code>, coloque-o em <code>static/json/examples/</code>.</p>
                    {% endif %}
                    </section>
                </div>
            </div>
        </section>

        <!-- ... existing HTML for text input form ... -->
        <div class="row mt-4">
            <div class="col-md-12">
                <h2>Análises Salvas</h2>
                {% if saved_analyses %}
                    <ul class="list-group">
                        {% for analysis in saved_analyses %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <a href="{{ url_for('view_analysis_route', analysis_uuid=analysis.analysis_uuid) }}">
                                    {{ analysis.name }}
                                </a>
                                <small>Salva em: {{ analysis.created_at.strftime('%Y-%m-%d %H:%M:%S') if analysis.created_at else 'Data desconhecida' }}</small>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>Nenhuma análise salva encontrada no banco de dados.</p>
                {% endif %}
            </div>
        </div>

        <!-- This is where the network visualization usually starts -->
        <!-- Ensure this new section is appropriately placed relative to your existing layout -->
        <!-- The main network visualization for the index page is in the header in this template -->
        <!-- The placeholder <div id="mynetwork"></div> is typically for the network page, not index. -->
        <!-- So, the comment above about "mynetwork" might be slightly misleading for this specific index.html -->
        <!-- For this template, the new section is placed before the "Sobre" card. -->

        <div class="card mb-4">
            <div class="card-header">
              Sobre
            </div>
            <div class="card-body">
                <p class="card-text"><strong>Andrey Alvarenga Duarte</strong><br>
                <a href="mailto:andreyduarte.aad@gmail.com">andreyduarte.aad@gmail.com</a><br>
                GitHub: <a href="https://github.com/andreyduarte/AutoAnaliseFuncional" target="_blank">AutoAnáliseFuncional</a></p>
            </div>
        </div>
    </div>

    <footer class="footer mt-auto py-3 bg-light">
        <div class="container text-center">
            <span class="text-muted">&copy; 2023 Análise Funcional Automática</span>
        </div>
    </footer>

    <script type="text/javascript">
        window.nodesData = {{nodes_data|safe}};
        window.edgesData = {{edges_data|safe}};
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Lógica para o contador de caracteres no textarea
        const analysisTextareaIndex = document.querySelector('textarea[name="texto_entrada"]');
        const charCountIndex = document.getElementById('charCountIndex');
        const maxLengthIndex = analysisTextareaIndex.getAttribute('maxlength');

        function updateCharCountIndex() {
            const currentLength = analysisTextareaIndex.value.length;
            charCountIndex.innerText = `${currentLength}/${maxLengthIndex} caracteres`;
        }

        analysisTextareaIndex.addEventListener('input', updateCharCountIndex);

        // Inicializa o contador ao carregar a página
        document.addEventListener('DOMContentLoaded', updateCharCountIndex);

        document.querySelector('form').addEventListener('submit', function() {
            document.getElementById('loadingOverlay').classList.add('visible');
        });
    </script>
</body>
</html>
